(function(e){function n(n,r){this.defaults={classPrefix:"",width:"100%",showValue:false,showRange:false,onStart:null,onChange:null,onEnd:null,minChangeInterval:0};this.options=e.extend({},this.defaults,r);this.input=e(n);this.dragging=0;this.ranged=false;this.startValue=0;this.startValueLeft=null;this.startValueRight=null;this.wrapId=null;this.handleLeftId=null;this.handleRightId=null;this.connectorId=null;this.valueId=null;this.rangeMinId=null;this.rangeMaxId=null;this.wrap=null;this.handleLeft=null;this.handleRight=null;this.connector=null;this.value=null;this.rangeMin=null;this.rangeMax=null;this.lastChangeTime=null;this.activeHandle=0;this.setupDom=function(){t++;this.startValue=this.input.val();if(this.startValue.indexOf(" ")!=-1){var n=this.startValue.split(" ");this.startValueLeft=parseInt(n[0]);this.startValueRight=n[1];this.startValue=this.startValueLeft;this.ranged=true}var r=this.input.attr("id");if(r==null){r=t}this.wrapId="slider-wrap-"+r;this.input.after(e("<div/>",{id:this.wrapId,"class":this.options.classPrefix+"slider-wrap"}));this.wrap=e("#"+this.wrapId);this.wrap.css({width:this.options.width});this.connectorId="slider-connector-left-"+r;this.wrap.append(e("<div/>",{id:this.connectorId,"class":this.options.classPrefix+"slider-connector-left"}));this.connector=e("#"+this.connectorId);this.handleLeftId="slider-handle-left-"+r;this.wrap.append(e("<div/>",{id:this.handleLeftId,"class":this.options.classPrefix+"slider-handle-left"}));this.handleLeft=e("#"+this.handleLeftId);if(this.ranged){this.handleRightId="slider-handle-right-"+r;this.wrap.append(e("<div/>",{id:this.handleRightId,"class":this.options.classPrefix+"slider-handle-right"}));this.handleRight=e("#"+this.handleRightId)}if(this.options.showValue){this.valueId="slider-value-"+r;this.wrap.append(e("<div/>",{id:this.valueId,"class":this.options.classPrefix+"slider-value"}));this.wrap.addClass("with-value");this.value=e("#"+this.valueId);if(!this.ranged){this.value.html(Math.round(this.startValue*10)/10)}else{this.value.html(Math.round(this.startValueLeft*10)/10+" - "+Math.round(this.startValueRight*10)/10)}}if(this.options.showRange){var i=this.input.data("min")||0,s=this.input.data("max")||100;this.rangeMinId="slider-range-min-"+r;this.rangeMaxId="slider-range-max-"+r;this.wrap.append(e("<div/>",{id:this.rangeMinId,"class":this.options.classPrefix+"slider-range-min"}));this.wrap.append(e("<div/>",{id:this.rangeMaxId,"class":this.options.classPrefix+"slider-range-max"}));this.wrap.addClass("with-range");this.rangeMin=e("#"+this.rangeMinId);this.rangeMax=e("#"+this.rangeMaxId);this.rangeMin.html(i);this.rangeMax.html(s)}this.setValue(this.input.val());this.input.hide()};this.setupEvents=function(){var t=this;this.handleLeft.mousedown(function(n){t.onDragStart(n);t.onDragStartLeft(n);e(document).unbind("mousemove").mousemove(function(e){t.onDragProgress(e)});e(document).one("mouseup",function(n){e(document).unbind("mousemove");t.onDragEnd(n)});e(document).one("mousedown",function(){t.activeHandle=0});for(var r=0;r<window._jQsliders.length;r++){window._jQsliders[r].activeHandle=0}t.activeHandle=1;n.preventDefault();return false});if(this.ranged){this.handleRight.mousedown(function(n){t.onDragStart(n);t.onDragStartRight(n);e(document).unbind("mousemove").mousemove(function(e){t.onDragProgress(e)});e(document).one("mouseup",function(n){e(document).unbind("mousemove");t.onDragEnd(n)});e(document).one("mousedown",function(){t.activeHandle=0});for(var r=0;r<window._jQsliders.length;r++){window._jQsliders[r].activeHandle=0}t.activeHandle=2;n.preventDefault();return false})}e(document).keydown(function(e){t.onKeyDown(e)});this.wrap.click(function(e){t.jumpTo(e.clientX)})};this.onDragStart=function(e){this.disableTextSelect()};this.onDragStartLeft=function(e){this.dragging=1;if(typeof this.options.onStart=="function"){this.options.onStart("left",this.input[0])}if(typeof this.options.onStartLeft=="function"){this.options.onStartLeft(this.input[0])}};this.onDragStartRight=function(e){this.dragging=2;if(typeof this.options.onStart=="function"){this.options.onStart("right",this.input[0])}if(typeof this.options.onStartRight=="function"){this.options.onStartRight(this.input[0])}};this.onDragProgress=function(e){if(this.dragging==0){return}var t=this.wrap.offset().left,n=parseInt(this.wrap.width()),r=Math.min(Math.max(e.clientX-t,0),n);if(this.ranged){var i=this.handleLeft.position().left,s=this.handleRight.position().left;if(this.dragging==1&&r>s){r=s}else if(this.dragging==2&&r<i){r=i}}var o=this.input.data("min")||0,u=this.input.data("max")||100,a=this.input.data("step")||1,f=u-o,l=r/n,c=Math.round((f*l+o)/a)*a,h,p;l=(c-o)/f;r=n*l;if(!this.ranged){this.handleLeft.css({left:r});this.connector.css({width:r});this.input.attr("value",c);if(this.options.showValue){this.value.html(Math.round(c*10)/10)}if(typeof this.options.onChange=="function"){if(this.options.minChangeInterval==0){this.options.onChange(c,this.input[0])}else{h=this.getMillitime();p=h-this.lastChangeTime;if(this.options.minChangeInterval==null||p>=this.options.minChangeInterval){this.options.onChange(c,this.input[0]);this.lastChangeTime=h}}}}else{var d=this.dragging==1?this.handleLeft:this.handleRight,v=this.input.val().split(" "),m=parseInt(v[0]),g=parseInt(v[1]);d.css({left:r});var y=this.handleLeft.position().left,b=this.handleRight.position().left;this.connector.css({left:y,width:b-y});if(this.dragging==1){m=c}else{g=c}this.input.attr("value",m+" "+g);if(this.options.showValue){this.value.html(Math.round(m*10)/10+" - "+Math.round(g*10)/10)}if(typeof this.options.onChange=="function"){this.options.onChange(m,g,this.input[0])}if(typeof this.options.onChange=="function"){if(this.options.minChangeInterval==0){this.options.onChange(m,g,this.input[0])}else{h=this.getMillitime();p=h-this.lastChangeTime;if(this.options.minChangeInterval==null||p>=this.options.minChangeInterval){this.options.onChange(m,g,this.input[0]);this.lastChangeTime=h}}}}this.input.trigger("change")};this.onDragEnd=function(e){if(this.dragging==0){return}if(typeof this.options.onEnd=="function"){this.options.onEnd(this.input.val(),this.dragging==1?"left":"right",this.input[0])}this.dragging=0;this.enableTextSelect()};this.onKeyDown=function(e){if(this.activeHandle==0||e.keyCode!=37&&e.keyCode!=39){return}var t=this.input.val(),n,r,i;if(this.ranged){n=parseInt(t.split(" ")[0]);r=parseInt(t.split(" ")[1]);if(this.activeHandle==1){i=n}else{i=r}}else{n=parseInt(t);i=n}var s=parseInt(this.input.data("min"))||0,o=parseInt(this.input.data("max"))||100,u=parseInt(this.input.data("step"))||1,a;if(e.shiftKey){u*=10}if(e.keyCode==37){i=Math.max(i-u,s)}else{i=Math.min(i+u,o)}if(this.ranged){if(this.activeHandle==1){if(i>r){i=r}this.setValue(i+" "+r)}else{if(i<n){i=n}this.setValue(n+" "+i)}}else{this.setValue(i)}console.log("key",e.keyCode,this.activeHandle,a)};this.jumpTo=function(e){if(this.dragging!=0){return}var t=this.wrap.offset().left,n=parseInt(this.wrap.width()),r=Math.min(Math.max(e-t,0),n),i={clientX:e};for(var s=0;s<window._jQsliders.length;s++){window._jQsliders[s].activeHandle=0}this.dragging=!this.ranged||r<n/2?1:2;this.activeHandle=this.dragging;this.onDragProgress(i);this.dragging=0};this.setValue=function(e){this.startValue=e;if(typeof e=="string"&&e.indexOf(" ")!=-1){var t=e.split(" ");this.startValueLeft=parseInt(t[0]);this.startValueRight=t[1];this.startValue=this.startValueLeft;this.ranged=true}var n=this.input.data("min")||0,r=this.input.data("max")||100,i=this.input.data("step")||1,s=r-n,o=parseInt(this.wrap.width());if(this.ranged){if(this.startValueLeft<n){this.startValueLeft=n}if(this.startValueRight<n){this.startValueRight=n}if(this.startValueLeft>r){this.startValueLeft=r}if(this.startValueRight>r){this.startValueRight=r}var u=Math.round(this.startValueLeft/i)*i,a=(u-n)/s,f=o*a,l=Math.round(this.startValueRight/i)*i,c=(l-n)/s,h=o*c;this.handleLeft.css({left:f});this.handleRight.css({left:h});this.connector.css({left:f,width:h-f});this.input.attr("value",u+" "+l);if(this.options.showValue){this.value.html(Math.round(u*10)/10+" - "+Math.round(l*10)/10)}if(typeof this.options.onChange=="function"){this.options.onChange(u,l,this.input[0])}}else{if(this.startValue<n){this.startValue=n}else if(this.startValue>r){this.startValue=r}var p=Math.round(this.startValue/i)*i,d=(p-n)/s,v=o*d;this.handleLeft.css({left:v});this.connector.css({width:v});this.input.attr("value",e);if(this.options.showValue){this.value.html(Math.round(p*10)/10)}if(typeof this.options.onChange=="function"){this.options.onChange(p,this.input[0])}}this.input.trigger("change")};this.disableTextSelect=function(){e("*").attr("unselectable","on").css("user-select","none").on("selectstart",false).addClass("slider-unselectable")};this.enableTextSelect=function(){e("*").removeAttr("unselectable").css("user-select","").unbind("selectstart").removeClass("slider-unselectable")};this.getMillitime=function(){return(new Date).getTime()}}var t=0;n.prototype={init:function(){if(typeof window._jQsliders=="undefined"){window._jQsliders=[]}window._jQsliders.push(this);this.setupDom();this.setupEvents()},range:function(e,t,n){this.input.data("min",e);this.input.data("max",t);if(typeof n=="number"){this.input.data("step",n)}if(this.options.showRange){this.rangeMin.html(e);this.rangeMax.html(t)}this.setValue(this.input.val())},min:function(e){this.range(e,this.input.data("max"))},max:function(e){this.range(this.input.data("min"),e)},val:function(e,t){if(typeof t!="undefined"){e=parseInt(e)+" "+parseInt(t)}else if(parseInt(e)==e){e=parseInt(e)}this.setValue(e)},change:function(e){this.options.onChange=e},start:function(e){this.options.onStart=e},end:function(e){this.options.onEnd=e}};e.fn.slider=function(t){var r=Array.prototype.slice.call(arguments);if(this.length){this.each(function(){var i=e(this).data("slider");if(i==null){i=new n(this,t);i.init();e(this).data("slider",i)}else{if(r.length==0){return}var s=r[0];if(typeof i[s]=="function"){i[s].apply(i,r.slice(1))}}})}}})(jQuery)